<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CSV to JSON Converter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; color: #333; }
    h1 { font-size: 1.2em; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    textarea { width: 100%; height: 150px; font-family: monospace; border: 1px solid #ccc; background: #f9f9f9; }
    .section { margin-bottom: 30px; padding: 15px; border: 1px solid #eee; border-radius: 5px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    h3 { margin-top: 0; font-size: 1em; color: #555; }
    input[type="file"] { margin-bottom: 10px; }
  </style>
</head>
<body>
  <div id="app">
    <h1>Firebaseインポート用データ変換ツール</h1>
    
    <div class="section">
      <h3>1. Data.csv (Date, Status) を選択</h3>
      <input type="file" @change="loadDataCsv" accept=".csv">
      <div v-if="dataJson">
        <p style="font-size:0.8em; color:green;">▼ 下記をコピーしてインポート用スクリプトの <code>csvData</code> に上書きしてください</p>
        <textarea readonly>{{ dataJson }}</textarea>
      </div>
    </div>

    <div class="section">
      <h3>2. Config.csv (Date, Memo) を選択</h3>
      <input type="file" @change="loadConfigCsv" accept=".csv">
      <div v-if="configJson">
         <p style="font-size:0.8em; color:green;">▼ 下記をコピーしてインポート用スクリプトで使ってください</p>
        <textarea readonly>{{ configJson }}</textarea>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref } = Vue;
    createApp({
      setup() {
        const dataJson = ref('');
        const configJson = ref('');

        const csvToJson = (csvText, keyName) => {
          const lines = csvText.trim().split(/\r\n|\n/);
          // 1行目はヘッダとしてスキップ
          const result = [];
          for (let i = 1; i < lines.length; i++) {
            const line = lines[i];
            if (!line) continue;
            const vals = line.split(',');
            if (vals.length < 2) continue;
            
            const date = vals[0].trim();
            const val = vals[1].trim();
            
            if (date) {
               const obj = { date: date };
               // Configならmemo, Dataならstatus
               if(keyName === 'memo') obj.status = val; // memoデータもstatusフィールドとして扱う設計の場合
               else obj[keyName] = val;
               
               // ※注意: 元のインポートスクリプトは 'status' フィールドを見る設計になっています。
               // Config(会社休暇)の場合は { date:..., status: 'HOLIDAY:会社休暇' } のように加工が必要かもしれません。
               // ここでは単純な変換を行います。
               if(keyName === 'memo') {
                 // Config.csvの場合の特別処理（インポートスクリプトの仕様に合わせるなら）
                 // もしConfigが単に休日リストなら、コレクションを分けるか、status='HOLIDAY'にするかですが
                 // 今回はConfigコレクションへインポートする前提で変換します。
                 obj.memo = val;
                 delete obj.status;
               }

               result.push(obj);
            }
          }
          return JSON.stringify(result, null, 2);
        };

        const loadFile = (file, callback) => {
           const reader = new FileReader();
           reader.onload = (e) => callback(e.target.result);
           reader.readAsText(file);
        };

        const loadDataCsv = (e) => {
           const file = e.target.files[0];
           if(!file) return;
           loadFile(file, (text) => {
              // Data.csv -> { date, status }
              dataJson.value = 'const csvData = ' + csvToJson(text, 'status') + ';';
           });
        };

        const loadConfigCsv = (e) => {
           const file = e.target.files[0];
           if(!file) return;
           loadFile(file, (text) => {
              // Config.csv -> { date, memo }
              dataJson.value = ''; // Clear other box
              configJson.value = 'const configData = ' + csvToJson(text, 'memo') + ';';
           });
        };

        return { dataJson, configJson, loadDataCsv, loadConfigCsv };
      }
    }).mount('#app');
  </script>
</body>
</html>
